<form [formGroup]="form" (ngSubmit)="onSubmit($event)" novalidate>
  <p-card [header]="titleCard">
    @if (isView) {
    <div class="w-full flex md:flex-row flex-column justify-content-between align-items-center align-content-center">
      <div class="flex flex-row justify-content-center md:justify-content-start align-items-center align-content-center md:pb-0 pb-2">
        <small><strong>Código do produto: </strong> {{ responseProduto?.codigo ?? '-'}} </small>
      </div>
      <p-tag [severity]="responseProduto?.status ? 'success' : 'danger'" [value]="responseProduto?.status ? 'Ativo' : 'Inativo'" class="w-full md:w-auto" />
    </div>
    }
    <!-- CAMPOS PRINCIPAIS -->
    <div class="grid">
      <!-- Nome -->
      <div class="col-12 lg:col-6">
        <label for="nome-produto">Nome</label>
        <input
          pInputText
          type="text"
          maxlength="100"
          class="w-full mt-1"
          id="nome-produto"
          formControlName="nome"
          placeholder="Informe o nome..."
        />
        <app-form-control-errors
          [control]="getControlForm('nome')"
        ></app-form-control-errors>
      </div>

      <!-- Preço de Custo -->
      <div class="col-12 lg:col-3">
        <label for="preco-custo">Preço de Custo</label>
        <input
          pInputText
          step="0.01"
          type="text"
          currencyMask
          id="preco-custo"
          placeholder="R$"
          class="w-full mt-1"
          formControlName="precoCusto"
          [options]="optionsCurrencyMask"
        />
        <app-form-control-errors
          [control]="getControlForm('precoCusto')"
        ></app-form-control-errors>
      </div>

      <!-- Preço de Venda -->
      <div class="col-12 lg:col-3">
        <label for="preco-venda">Preço de Venda</label>
        <input
          pInputText
          step="0.01"
          type="text"
          currencyMask
          id="preco-venda"
          placeholder="R$"
          class="w-full mt-1"
          formControlName="precoVenda"
          [options]="optionsCurrencyMask"
        />
        <app-form-control-errors
          [control]="getControlForm('precoVenda')"
        ></app-form-control-errors>
      </div>

      @if (isView) {
        <!-- Quantidade Estoque -->
        <div class="col-12 lg:col-4">
          <label for="quantidade-estoque">Quantidade em estoque</label>
          <input
            pInputText
            type="text"
            [disabled]="true"
            class="w-full mt-1"
            id="quantidade-estoque"
            [value]="responseProduto?.quantidadeEmEstoque ?? '-'"
          />
        </div>
      }

      <!-- Marca -->
      <div class="col-12" [ngClass]="isView ? 'lg:col-4' : 'lg:col-6'">
        <label
          for="marca-produto"
          class="flex flex-row align-items-center"
          >
            Marca
            @if (!isView) {
              <i class="pi pi-info-circle ml-1 text-primary" (mouseenter)="onMouseEnterMarca($event)"></i>
            }
        </label>
        @if (loadingAutocompleteMarca$ | async) {
          <app-loading></app-loading>
        } @if (!(loadingAutocompleteMarca$ | async)) {
          <p-select
            [filter]="true"
            id="marca-produto"
            [showClear]="true"
            optionValue="value"
            optionLabel="label"
            class="w-full mt-1"
            [options]="marcaOptions"
            formControlName="idMarca"
            filterPlaceholder="Busca..."
            [placeholder]="isView || isEditable ? '' : 'Selecione a marca'"
          ></p-select>
          <app-form-control-errors
            [control]="getControlForm('idMarca')"
          ></app-form-control-errors>
        }
      </div>

      <!-- Categoria -->
      <div class="col-12" [ngClass]="isView ? 'lg:col-4' : 'lg:col-6'">
        <label
          for="categoria-produto"
          class="flex flex-row align-items-center"
          >
            Categoria
            @if (!isView) {
              <i class="pi pi-info-circle ml-1 text-primary" (mouseenter)="onMouseEnterCategoria($event)"></i>
            }
        </label>
        @if (loadingAutocompleteCategoria$ | async) {
          <app-loading></app-loading>
        } @if (!(loadingAutocompleteCategoria$ | async)) {
          <p-select
            id="categoria-produto"
            formControlName="idCategoria"
            [options]="categoriaOptions"
            optionLabel="label"
            [showClear]="true"
            optionValue="value"
            [placeholder]="isView || isEditable ? '' : 'Selecione a categoria'"
            [filter]="true"
            filterPlaceholder="Busca..."
            class="w-full mt-1"
          ></p-select>
          <app-form-control-errors
            [control]="getControlForm('idCategoria')"
          ></app-form-control-errors>
        }
      </div>

      <!-- Descrição -->
      <div class="col-12">
        <label for="descricao-produto">Descrição</label>
        <textarea
          [rows]="5"
          [cols]="30"
          pInputTextarea
          class="w-full mt-1"
          [autoResize]="true"
          id="descricao-produto"
          formControlName="descricao"
        ></textarea>
        <app-form-control-errors
          [control]="getControlForm('descricao')"
        ></app-form-control-errors>
      </div>
    </div>

    <!-- INFORMAÇÕES COMPLEMENTARES -->
    @if (isView) {
      <div class="flex flex-row justify-content-between">
        <small><strong>Usuário: </strong> {{ responseProduto?.createdBy }}</small>
        <small><strong>Data: </strong>{{ responseProduto?.createdAt | date : "dd/MM/yyyy HH:mm" }}</small>
      </div>
    }

    <!-- BOTÕES -->
    <div [ngClass]="[isView ? 'justify-content-start' : 'justify-content-between']" class="pt-2 flex flex-wrap flex-column-reverse md:flex-row">
      <div class="col-12 p-0 md:col-2 mt-2 md:mt-0">
        <p-button
          label="Voltar"
          class="w-full"
          variant="outlined"
          styleClass="w-full"
          severity="secondary"
          (onClick)="onVoltar()"
          [disabled]="onCreateUpdate$ | async"
        />
      </div>
      @if (!isView && !(onCreateUpdate$ | async)) {
        <div class="col-12 mt-2 p-0 md:col-2 md:mt-0">
          <p-button
            type="submit"
            class="w-full"
            styleClass="w-full"
            [label]="isCreate ? 'Adicionar' : 'Atualizar'"
            [disabled]="form.invalid || (onCreateUpdate$ | async)"
          />
        </div>
      } @if (onCreateUpdate$ | async) {
        <app-loading></app-loading>
      }
    </div>
  </p-card>
</form>

<app-generic-pop-over (mouseleave)="onMouseLeavePopOver()"></app-generic-pop-over>
